# PDF Export Implementation

## Overview

The PDF export feature generates professional, detailed reports of estimate comparisons that can be saved, shared, or printed.

## Features

### Report Sections

1. **Header**
   - Title: "Estimate Comparison Report"
   - Red accent color matching brand

2. **Client Information**
   - Client name
   - Claim number
   - Report generation date

3. **Summary of Discrepancies**
   - Total cost difference (highlighted)
   - Missing items count
   - Discrepancies count
   - Critical issues count (red)
   - Minor issues count

4. **Missing Items Table**
   - Item description
   - Quantity
   - Unit price
   - Total price
   - Priority (critical/minor with color coding)

5. **Discrepancies Section**
   - Each discrepancy in a colored box
   - Critical: Red border and background
   - Minor: Yellow/amber border and background
   - Shows: Item, type, adjuster value, contractor value, difference, percentage

6. **Notes/Comments**
   - User-added notes and comments
   - Full text included in report

7. **Footer**
   - Page numbers (Page X of Y)
   - "Generated by Manny's ToolBox" branding

## Technical Details

### Library
- **pdfkit**: Node.js PDF generation library
- Professional quality output
- Full control over layout and styling

### Styling
- **Colors**:
  - Primary: Red (#dc2626) for headers and critical items
  - Secondary: Yellow/Amber (#f59e0b) for minor items
  - Background: Light red/yellow for discrepancy boxes
- **Fonts**: Helvetica (standard and bold)
- **Layout**: Letter size (8.5" x 11")
- **Margins**: 50 points on all sides

### Page Management
- Automatic page breaks
- Tables and sections flow across pages
- Footer on each page
- Proper spacing and alignment

## Usage

### From Frontend
```typescript
const response = await fetch('/api/tools/estimate-comparison/export', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    clientName,
    claimNumber,
    comparisonResult,
    notes,
    showSideBySide,
    showHighlighted,
  }),
})

const blob = await response.blob()
// Download or display PDF
```

### API Endpoint
- **Route**: `/api/tools/estimate-comparison/export`
- **Method**: POST
- **Auth**: Required (user must be signed in)
- **Response**: PDF file (application/pdf)

## File Naming

PDFs are automatically named:
```
Estimate_Comparison_{ClientName}_{ClaimNumber}.pdf
```

Example:
```
Estimate_Comparison_John_Smith_CLAIM12345.pdf
```

## Future Enhancements

1. **Side-by-Side View**: When `showSideBySide` is true, display estimates side-by-side
2. **Highlighted Differences**: When `showHighlighted` is true, highlight differences in color
3. **Custom Branding**: Allow users to customize colors/logos
4. **Email Integration**: Send PDFs directly via email
5. **Cloud Storage**: Save to cloud storage (S3, Google Drive, etc.)

## Dependencies

- `pdfkit`: ^0.14.0
- Installed via: `npm install pdfkit`

## Error Handling

- Validates required fields (clientName, claimNumber, comparisonResult)
- Handles PDF generation errors gracefully
- Returns appropriate HTTP status codes
- Logs errors for debugging
